#!/bin/bash
#SBATCH --job-name=build_topics
#SBATCH --output=slurm_build_topics_%j.out
#SBATCH --error=slurm_build_topics_%j.err
#SBATCH --time=00:30:00
#SBATCH --mem=4G
#SBATCH --partition=standard
#SBATCH --account=bddur51  # â† Add this line

# Load conda environment
source /projects/bddur51/samjmwaugh/miniconda/etc/profile.d/conda.sh
conda activate embedding_env

# Set RUN_ROOT (update this path as needed)
export RUN_ROOT=/nobackup/projects/bddur51/oa_run_914266

echo "ï¿½ï¿½ Starting build_topics_json.py job"
echo "ï¿½ï¿½ Job started at: $(date)"
echo "ğŸ–¥ï¸  Running on: $(hostname)"
echo "ğŸ“ RUN_ROOT: $RUN_ROOT"
echo "ï¿½ï¿½ Current directory: $(pwd)"

# Check if works.json exists
if [ ! -f "$RUN_ROOT/works.json" ]; then
    echo "âŒ Error: works.json not found at $RUN_ROOT/works.json"
    exit 1
fi

echo "ğŸ“– Found works.json, starting topic index building..."

# Run the script
cd /projects/bddur51/artefact-context
python pipeline/build_topics_json.py

# Check exit status
if [ $? -eq 0 ]; then
    echo "âœ… build_topics_json.py completed successfully"
    echo "ğŸ“ Topics file created at: $RUN_ROOT/topics.json"
else
    echo "âŒ build_topics_json.py failed"
    exit 1
fi

echo "ğŸ“… Job completed at: $(date)"