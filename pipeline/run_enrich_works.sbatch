#!/bin/bash
#SBATCH --job-name=enrich_works
#SBATCH --output=slurm_enrich_works_%j.out
#SBATCH --error=slurm_enrich_works_%j.err
#SBATCH --time=02:00:00
#SBATCH --mem=8G
#SBATCH --partition=standard

# Load conda environment
source /projects/bddur51/samjmwaugh/miniconda/etc/profile.d/conda.sh
conda activate embedding_env

# Set RUN_ROOT (update this path as needed)
export RUN_ROOT=/nobackup/projects/bddur51/oa_run_914266

echo "ğŸš€ Starting enrich_works_metadata.py job"
echo "ï¿½ï¿½ Job started at: $(date)"
echo "ğŸ–¥ï¸  Running on: $(hostname)"
echo "ğŸ“ RUN_ROOT: $RUN_ROOT"
echo "ï¿½ï¿½ Current directory: $(pwd)"

# Check if works.json exists
if [ ! -f "$RUN_ROOT/works.json" ]; then
    echo "âŒ Error: works.json not found at $RUN_ROOT/works.json"
    exit 1
fi

echo "ğŸ“– Found works.json, starting metadata enrichment..."

# Run the script
cd /projects/bddur51/artefact-context
python pipeline/enrich_works_metadata.py

# Check exit status
if [ $? -eq 0 ]; then
    echo "âœ… enrich_works_metadata.py completed successfully"
    echo "ğŸ“ Enriched works file created at: $RUN_ROOT/works_enriched.json"
else
    echo "âŒ enrich_works_metadata.py failed"
    exit 1
fi

echo "ğŸ“… Job completed at: $(date)"